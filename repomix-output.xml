This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
backend/chat.db
backend/go.mod
backend/main.go
frontend/.gitignore
frontend/.npmrc
frontend/.prettierignore
frontend/.prettierrc
frontend/.vscode/settings.json
frontend/package.json
frontend/README.md
frontend/src/app.d.ts
frontend/src/app.html
frontend/src/lib/assets/favicon.svg
frontend/src/lib/index.ts
frontend/src/routes/+layout.svelte
frontend/src/routes/+page.svelte
frontend/src/routes/layout.css
frontend/static/robots.txt
frontend/svelte.config.js
frontend/tsconfig.json
frontend/vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# 忽略前端依赖
frontend/node_modules/
frontend/.svelte-kit/
frontend/build/

# 忽略后端编译文件
backend/backend.exe

# 忽略系统文件
.DS_Store
Thumbs.db
</file>

<file path="backend/go.mod">
module lobe-backend

go 1.25.5

require (
	github.com/labstack/echo/v4 v4.15.0
	modernc.org/sqlite v1.42.2
)

require (
	github.com/dustin/go-humanize v1.0.1 // indirect
	github.com/google/uuid v1.6.0 // indirect
	github.com/labstack/gommon v0.4.2 // indirect
	github.com/mattn/go-colorable v0.1.14 // indirect
	github.com/mattn/go-isatty v0.0.20 // indirect
	github.com/ncruces/go-strftime v0.1.9 // indirect
	github.com/remyoudompheng/bigfft v0.0.0-20230129092748-24d4a6f8daec // indirect
	github.com/valyala/bytebufferpool v1.0.0 // indirect
	github.com/valyala/fasttemplate v1.2.2 // indirect
	golang.org/x/crypto v0.46.0 // indirect
	golang.org/x/exp v0.0.0-20250620022241-b7579e27df2b // indirect
	golang.org/x/net v0.48.0 // indirect
	golang.org/x/sys v0.39.0 // indirect
	golang.org/x/text v0.32.0 // indirect
	golang.org/x/time v0.14.0 // indirect
	modernc.org/libc v1.66.10 // indirect
	modernc.org/mathutil v1.7.1 // indirect
	modernc.org/memory v1.11.0 // indirect
)
</file>

<file path="backend/main.go">
package main

import (
	"bufio"
	"bytes"
	"database/sql"
	"encoding/json"
	"fmt"
	"log"
	"net/http"
	"strings"

	"github.com/labstack/echo/v4"
	"github.com/labstack/echo/v4/middleware"
	_ "modernc.org/sqlite"
)

const (
	API_KEY = "sk-b828e1362f614206bde9ddf87b2476a2"
	API_URL = "https://api.deepseek.com/chat/completions"
	DB_FILE = "./chat.db"
)

var db *sql.DB

type Message struct {
	Role    string `json:"role"`
	Content string `json:"content"`
}

type ChatRequest struct {
	Message string `json:"message"`
}

func initDB() {
	var err error
	db, err = sql.Open("sqlite", DB_FILE)
	if err != nil {
		log.Fatal(err)
	}
	sqlStmt := `CREATE TABLE IF NOT EXISTS messages (id INTEGER PRIMARY KEY AUTOINCREMENT, role TEXT NOT NULL, content TEXT NOT NULL, created_at DATETIME DEFAULT CURRENT_TIMESTAMP);`
	_, err = db.Exec(sqlStmt)
	if err != nil {
		log.Fatal(err)
	}
}

func saveMessage(role, content string) {
	_, err := db.Exec("INSERT INTO messages (role, content) VALUES (?, ?)", role, content)
	if err != nil {
		log.Println("保存失败:", err)
	}
}

func main() {
	initDB()
	defer db.Close()

	e := echo.New()
	e.Use(middleware.CORSWithConfig(middleware.CORSConfig{
		AllowOrigins: []string{"http://localhost:5173"},
		AllowMethods: []string{http.MethodGet, http.MethodPost, http.MethodDelete, http.MethodOptions},
	}))

	e.GET("/api/history", func(c echo.Context) error {
		rows, err := db.Query("SELECT role, content FROM messages ORDER BY id ASC")
		if err != nil {
			return c.JSON(500, map[string]string{"error": "读取失败"})
		}
		defer rows.Close()
		var history []Message
		for rows.Next() {
			var msg Message
			rows.Scan(&msg.Role, &msg.Content)
			history = append(history, msg)
		}
		return c.JSON(200, history)
	})

	e.DELETE("/api/history", func(c echo.Context) error {
		db.Exec("DELETE FROM messages")
		return c.JSON(200, map[string]string{"message": "已清空"})
	})

	e.POST("/api/chat", func(c echo.Context) error {
		req := new(ChatRequest)
		if err := c.Bind(req); err != nil {
			return err
		}
		saveMessage("user", req.Message)

		payload, _ := json.Marshal(map[string]interface{}{
			"model":    "deepseek-chat",
			"messages": []map[string]string{{"role": "user", "content": req.Message}},
			"stream":   true,
		})

		httpReq, _ := http.NewRequest("POST", API_URL, bytes.NewBuffer(payload))
		httpReq.Header.Set("Content-Type", "application/json")
		httpReq.Header.Set("Authorization", "Bearer "+API_KEY)

		resp, err := (&http.Client{}).Do(httpReq)
		if err != nil {
			return c.String(500, "AI 连接失败")
		}
		defer resp.Body.Close()

		c.Response().Header().Set(echo.HeaderContentType, "text/event-stream")
		c.Response().WriteHeader(http.StatusOK)

		var fullContent strings.Builder
		scanner := bufio.NewScanner(resp.Body)
		for scanner.Scan() {
			line := scanner.Text()
			if strings.HasPrefix(line, "data: ") {
				data := strings.TrimPrefix(line, "data: ")
				if data == "[DONE]" {
					break
				}
				var streamResp struct {
					Choices []struct {
						Delta struct {
							Content string `json:"content"`
						} `json:"delta"`
					} `json:"choices"`
				}
				if err := json.Unmarshal([]byte(data), &streamResp); err == nil {
					if len(streamResp.Choices) > 0 {
						content := streamResp.Choices[0].Delta.Content
						fullContent.WriteString(content)
						// 直接发送原始字符，不加 data: 前缀，前端处理更简单
						fmt.Fprint(c.Response().Writer, content)
						c.Response().Flush()
					}
				}
			}
		}
		if fullContent.Len() > 0 {
			saveMessage("assistant", fullContent.String())
		}
		return nil
	})

	e.Logger.Fatal(e.Start(":8080"))
}
</file>

<file path="frontend/.gitignore">
node_modules

# Output
.output
.vercel
.netlify
.wrangler
/.svelte-kit
/build

# OS
.DS_Store
Thumbs.db

# Env
.env
.env.*
!.env.example
!.env.test

# Vite
vite.config.js.timestamp-*
vite.config.ts.timestamp-*
</file>

<file path="frontend/.npmrc">
engine-strict=true
</file>

<file path="frontend/.prettierignore">
# Package Managers
package-lock.json
pnpm-lock.yaml
yarn.lock
bun.lock
bun.lockb

# Miscellaneous
/static/
</file>

<file path="frontend/.prettierrc">
{
	"useTabs": true,
	"singleQuote": true,
	"trailingComma": "none",
	"printWidth": 100,
	"plugins": [
		"prettier-plugin-svelte",
		"prettier-plugin-tailwindcss"
	],
	"tailwindStylesheet": "./src/routes/layout.css",
	"overrides": [
		{
			"files": "*.svelte",
			"options": {
				"parser": "svelte"
			}
		}
	]
}
</file>

<file path="frontend/.vscode/settings.json">
{
	"files.associations": {
		"*.css": "tailwindcss"
	}
}
</file>

<file path="frontend/README.md">
# sv

Everything you need to build a Svelte project, powered by [`sv`](https://github.com/sveltejs/cli).

## Creating a project

If you're seeing this, you've probably already done this step. Congrats!

```sh
# create a new project in the current directory
npx sv create

# create a new project in my-app
npx sv create my-app
```

## Developing

Once you've created a project and installed dependencies with `npm install` (or `pnpm install` or `yarn`), start a development server:

```sh
npm run dev

# or start the server and open the app in a new browser tab
npm run dev -- --open
```

## Building

To create a production version of your app:

```sh
npm run build
```

You can preview the production build with `npm run preview`.

> To deploy your app, you may need to install an [adapter](https://svelte.dev/docs/kit/adapters) for your target environment.
</file>

<file path="frontend/src/app.html">
<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		%sveltekit.head%
	</head>
	<body data-sveltekit-preload-data="hover">
		<div style="display: contents">%sveltekit.body%</div>
	</body>
</html>
</file>

<file path="frontend/src/lib/assets/favicon.svg">
<svg xmlns="http://www.w3.org/2000/svg" width="107" height="128" viewBox="0 0 107 128"><title>svelte-logo</title><path d="M94.157 22.819c-10.4-14.885-30.94-19.297-45.792-9.835L22.282 29.608A29.92 29.92 0 0 0 8.764 49.65a31.5 31.5 0 0 0 3.108 20.231 30 30 0 0 0-4.477 11.183 31.9 31.9 0 0 0 5.448 24.116c10.402 14.887 30.942 19.297 45.791 9.835l26.083-16.624A29.92 29.92 0 0 0 98.235 78.35a31.53 31.53 0 0 0-3.105-20.232 30 30 0 0 0 4.474-11.182 31.88 31.88 0 0 0-5.447-24.116" style="fill:#ff3e00"/><path d="M45.817 106.582a20.72 20.72 0 0 1-22.237-8.243 19.17 19.17 0 0 1-3.277-14.503 18 18 0 0 1 .624-2.435l.49-1.498 1.337.981a33.6 33.6 0 0 0 10.203 5.098l.97.294-.09.968a5.85 5.85 0 0 0 1.052 3.878 6.24 6.24 0 0 0 6.695 2.485 5.8 5.8 0 0 0 1.603-.704L69.27 76.28a5.43 5.43 0 0 0 2.45-3.631 5.8 5.8 0 0 0-.987-4.371 6.24 6.24 0 0 0-6.698-2.487 5.7 5.7 0 0 0-1.6.704l-9.953 6.345a19 19 0 0 1-5.296 2.326 20.72 20.72 0 0 1-22.237-8.243 19.17 19.17 0 0 1-3.277-14.502 17.99 17.99 0 0 1 8.13-12.052l26.081-16.623a19 19 0 0 1 5.3-2.329 20.72 20.72 0 0 1 22.237 8.243 19.17 19.17 0 0 1 3.277 14.503 18 18 0 0 1-.624 2.435l-.49 1.498-1.337-.98a33.6 33.6 0 0 0-10.203-5.1l-.97-.294.09-.968a5.86 5.86 0 0 0-1.052-3.878 6.24 6.24 0 0 0-6.696-2.485 5.8 5.8 0 0 0-1.602.704L37.73 51.72a5.42 5.42 0 0 0-2.449 3.63 5.79 5.79 0 0 0 .986 4.372 6.24 6.24 0 0 0 6.698 2.486 5.8 5.8 0 0 0 1.602-.704l9.952-6.342a19 19 0 0 1 5.295-2.328 20.72 20.72 0 0 1 22.237 8.242 19.17 19.17 0 0 1 3.277 14.503 18 18 0 0 1-8.13 12.053l-26.081 16.622a19 19 0 0 1-5.3 2.328" style="fill:#fff"/></svg>
</file>

<file path="frontend/src/lib/index.ts">
// place files you want to import through the `$lib` alias in this folder.
</file>

<file path="frontend/src/routes/+layout.svelte">
<script lang="ts">
	import './layout.css';
	import favicon from '$lib/assets/favicon.svg';

	let { children } = $props();
</script>

<svelte:head><link rel="icon" href={favicon} /></svelte:head>
{@render children()}
</file>

<file path="frontend/src/routes/layout.css">
@import 'tailwindcss';
</file>

<file path="frontend/static/robots.txt">
# allow crawling everything by default
User-agent: *
Disallow:
</file>

<file path="frontend/svelte.config.js">
import adapter from '@sveltejs/adapter-auto';
import { vitePreprocess } from '@sveltejs/vite-plugin-svelte';

/** @type {import('@sveltejs/kit').Config} */
const config = {
	// Consult https://svelte.dev/docs/kit/integrations
	// for more information about preprocessors
	preprocess: vitePreprocess(),

	kit: {
		// adapter-auto only supports some environments, see https://svelte.dev/docs/kit/adapter-auto for a list.
		// If your environment is not supported, or you settled on a specific environment, switch out the adapter.
		// See https://svelte.dev/docs/kit/adapters for more information about adapters.
		adapter: adapter()
	}
};

export default config;
</file>

<file path="frontend/tsconfig.json">
{
	"extends": "./.svelte-kit/tsconfig.json",
	"compilerOptions": {
		"rewriteRelativeImportExtensions": true,
		"allowJs": true,
		"checkJs": true,
		"esModuleInterop": true,
		"forceConsistentCasingInFileNames": true,
		"resolveJsonModule": true,
		"skipLibCheck": true,
		"sourceMap": true,
		"strict": true,
		"moduleResolution": "bundler"
	}
	// Path aliases are handled by https://svelte.dev/docs/kit/configuration#alias
	// except $lib which is handled by https://svelte.dev/docs/kit/configuration#files
	//
	// To make changes to top-level options such as include and exclude, we recommend extending
	// the generated config; see https://svelte.dev/docs/kit/configuration#typescript
}
</file>

<file path="frontend/vite.config.ts">
import tailwindcss from '@tailwindcss/vite';
import { sveltekit } from '@sveltejs/kit/vite';
import { defineConfig } from 'vite';

export default defineConfig({ plugins: [tailwindcss(), sveltekit()] });
</file>

<file path="frontend/package.json">
{
	"name": "frontend",
	"private": true,
	"version": "0.0.1",
	"type": "module",
	"scripts": {
		"dev": "vite dev",
		"build": "vite build",
		"preview": "vite preview",
		"prepare": "svelte-kit sync || echo ''",
		"check": "svelte-kit sync && svelte-check --tsconfig ./tsconfig.json",
		"check:watch": "svelte-kit sync && svelte-check --tsconfig ./tsconfig.json --watch",
		"format": "prettier --write .",
		"lint": "prettier --check ."
	},
	"devDependencies": {
		"@sveltejs/adapter-auto": "^7.0.0",
		"@sveltejs/kit": "^2.49.1",
		"@sveltejs/vite-plugin-svelte": "^6.2.1",
		"@tailwindcss/vite": "^4.1.17",
		"prettier": "^3.7.4",
		"prettier-plugin-svelte": "^3.4.0",
		"prettier-plugin-tailwindcss": "^0.7.2",
		"svelte": "^5.45.6",
		"svelte-check": "^4.3.4",
		"tailwindcss": "^4.1.17",
		"typescript": "^5.9.3",
		"vite": "^7.2.6"
	},
	"dependencies": {
		"lucide-svelte": "^0.562.0",
		"svelte-markdown": "^0.4.1"
	}
}
</file>

<file path="frontend/src/app.d.ts">
// See https://svelte.dev/docs/kit/types#app.d.ts
// for information about these interfaces
declare global {
	namespace App {
		// interface Error {}
		// interface Locals {}
		// interface PageData {}
		// interface PageState {}
		// interface Platform {}
	}
}

export {};

declare module 'svelte-markdown';
</file>

<file path="frontend/src/routes/+page.svelte">
<script lang="ts">
	import { Send, Menu, MessageSquare, User, Bot, Trash2, Plus, Square, Crown, Diamond, X, Edit2, Check, Sparkles, History } from 'lucide-svelte';
	import { tick, onMount } from 'svelte';
	import SvelteMarkdown from 'svelte-markdown';

	// --- 核心数据结构定义 ---
	type ChatSession = {
		title: string;
		history: { role: string; content: string }[];
	};

	let isSidebarOpen = $state(false);
	let inputText = $state(''); 
	let scrollContainer: HTMLElement | undefined = $state();
	
	// 当前显示的对话内容
	let chatHistory = $state([{ role: 'assistant', content: '> **SYSTEM NOTICE**\n> 正在绕过付费验证...\n> 开发者模式已激活。\n> \n> 哪怕只有两周，我们也要优雅地完成作业。请下达指令。' }]);
	// 当前显示的标题
	let currentTitle = $state('Project Specification'); 
	
	// --- 历史档案柜 (存储所有后台的对话) ---
	let archivedSessions = $state<ChatSession[]>([]); 
	
	let showRenameModal = $state(false);
	let tempTitle = $state(''); 
	let isRenamingHistoryIndex = $state(-1);
	let isLoading = $state(false);
	let abortController: AbortController | null = null;

	onMount(async () => {
		if (window.innerWidth > 768) isSidebarOpen = true;

		const savedCurrent = localStorage.getItem('justlobe_current_session');
		const savedArchives = localStorage.getItem('justlobe_archived_sessions');

		if (savedArchives) {
			try { archivedSessions = JSON.parse(savedArchives); } catch(e) {}
		}

		if (savedCurrent) {
			try {
				const session = JSON.parse(savedCurrent);
				currentTitle = session.title;
				chatHistory = session.history;
				scrollToBottom();
			} catch(e) {}
		} else {
			try {
				const res = await fetch('http://localhost:8080/api/history');
				if (res.ok) {
					const history = await res.json();
					if (history?.length > 0) chatHistory = history;
				}
			} catch(e) {}
		}
	});

	$effect(() => {
		const currentSession = { title: currentTitle, history: chatHistory };
		localStorage.setItem('justlobe_current_session', JSON.stringify(currentSession));
	});

	function startNewSession() {
		if (chatHistory.length > 1 || currentTitle !== 'Untitled Session') {
			const sessionToArchive: ChatSession = {
				title: currentTitle,
				history: [...chatHistory]
			};
			archivedSessions = [sessionToArchive, ...archivedSessions];
			localStorage.setItem('justlobe_archived_sessions', JSON.stringify(archivedSessions));
		}

		// 2. 清空当前屏幕，开始新的
		chatHistory = [{ role: 'assistant', content: '> **NEW SESSION**\n> System ready.' }];
		currentTitle = 'Untitled Session';
		
		// 3. 手机端自动收起
		if (window.innerWidth < 768) isSidebarOpen = false;
	}

	// --- 切换会话逻辑 (修复版) ---
	function switchSession(index: number) {
		// 1. 先把当前屏幕上的存进档案柜 (防止丢失)
		if (chatHistory.length > 1 || currentTitle !== 'Untitled Session') {
			const currentToArchive: ChatSession = {
				title: currentTitle,
				history: [...chatHistory]
			};
			// 注意：这里我们把当前对话加到列表最上面
			archivedSessions = [currentToArchive, ...archivedSessions];
		}
		const targetSession = archivedSessions[index]; // 还没存当前，所以index是对的

		const sessionToSave = { title: currentTitle, history: chatHistory };

		const newArchives = [...archivedSessions];
		newArchives.splice(index, 1);
		
		if (sessionToSave.history.length > 1 || sessionToSave.title !== 'Untitled Session') {
			newArchives.unshift(sessionToSave); 
		}
		
		archivedSessions = newArchives;
		currentTitle = targetSession.title;
		chatHistory = targetSession.history;
		
		// 保存到本地
		localStorage.setItem('justlobe_archived_sessions', JSON.stringify(archivedSessions));
		
		if (window.innerWidth < 768) isSidebarOpen = false;
		scrollToBottom();
	}

	function openRename(index = -1) {
		isRenamingHistoryIndex = index;
		tempTitle = index === -1 ? currentTitle : archivedSessions[index].title;
		showRenameModal = true;
	}

	function handleRenameClick(e: MouseEvent, index: number) {
		e.stopPropagation(); // 阻止冒泡
		openRename(index);   // 打开重命名
	}

	function confirmRename() {
		if (tempTitle.trim()) {
			if (isRenamingHistoryIndex === -1) {
				currentTitle = tempTitle;
			} else {
				archivedSessions[isRenamingHistoryIndex].title = tempTitle;
				localStorage.setItem('justlobe_archived_sessions', JSON.stringify(archivedSessions));
			}
		}
		showRenameModal = false;
	}

	// --- 现有的发送逻辑 (保持不变) ---
	async function sendMessage() {
		if (!inputText.trim()) return;
		const userMsg = inputText;
		chatHistory.push({ role: 'user', content: userMsg });
		inputText = ''; 
		await scrollToBottom();

		try {
			isLoading = true;
			abortController = new AbortController();

			chatHistory.push({ role: 'assistant', content: '' });
			const aiIdx = chatHistory.length - 1;

			const res = await fetch('http://localhost:8080/api/chat', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ message: userMsg }),
				signal: abortController.signal
			});

			const reader = res.body?.getReader();
			const decoder = new TextDecoder();

			if (reader) {
				while (true) {
					const { done, value } = await reader.read();
					if (done) break;

					let isNearBottom = false;
					if (scrollContainer) {
						const threshold = 100;
						const position = scrollContainer.scrollTop + scrollContainer.clientHeight;
						const height = scrollContainer.scrollHeight;
						isNearBottom = height - position < threshold;
					}

					chatHistory[aiIdx].content += decoder.decode(value, { stream: true });
					
					if (isNearBottom) scrollToBottom();
				}
			}
		} catch (e: any) {
			if (e.name === 'AbortError') console.log('用户停止生成');
			else chatHistory.push({ role: 'assistant', content: '> *连接已断开，请检查网络或余额。*' });
		} finally {
			isLoading = false;
			abortController = null;
		}
	}

	function stopGeneration() {
		if (abortController) {
			abortController.abort();
			abortController = null;
			isLoading = false;
			chatHistory[chatHistory.length - 1].content += "\n\n> ⛔ **[SYSTEM]** 用户强制终止了数据流。";
			scrollToBottom();
		}
	}

	function handleKeyDown(e: KeyboardEvent) {
		if (e.key === 'Enter' && !e.shiftKey && !isLoading) { e.preventDefault(); sendMessage(); }
	}

	async function scrollToBottom() {
		await tick();
		if (scrollContainer) scrollContainer.scrollTop = scrollContainer.scrollHeight;
	}

	async function clearChat() {
		if (confirm('警告：此操作将永久抹除当前对话记录。确定执行？')) {
			// 修改：只清空当前的，不发 DELETE 请求给后端了，因为后端是全量的
			chatHistory = [{ role: 'assistant', content: '> **SYSTEM**\n> 内存已格式化。请重新开始。' }];
		}
	}
</script>

<svelte:head>
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
	<link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,500;0,600;1,400&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&display=swap" rel="stylesheet">
</svelte:head>

<div class="h-screen w-full bg-[#141414] text-[#e5e5e5] flex md:grid md:grid-cols-[auto_1fr] overflow-hidden selection:bg-[#DBBA87] selection:text-black relative" style="font-family: 'Lora', serif;">
	
	<!-- 重命名弹窗 -->
	{#if showRenameModal}
		<div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/30 backdrop-blur-[5px] p-4 transition-all">
			<div class="w-full max-w-md bg-[#1a1a1a]/90 border border-[#DBBA87]/50 shadow-[0_0_50px_rgba(219,186,135,0.15)] rounded-2xl p-6 transform transition-all scale-100 backdrop-blur-xl">
				<div class="flex justify-between items-center mb-4">
					<span class="text-[#DBBA87] text-xs font-bold tracking-[0.2em] uppercase font-serif">Modify Alias</span>
					<button onclick={() => showRenameModal = false}><X size={18} class="text-[#666] hover:text-white transition-colors"/></button>
				</div>
				<input 
					bind:value={tempTitle}
					class="w-full bg-[#000]/50 border border-[#333] text-[#e5e5e5] text-lg p-4 rounded-xl focus:border-[#DBBA87] focus:outline-none font-serif mb-6 placeholder-[#444]"
					placeholder="Enter new alias..."
					onkeydown={(e) => e.key === 'Enter' && confirmRename()}
				/>
				<div class="flex justify-end gap-3">
					<button onclick={() => showRenameModal = false} class="px-4 py-2 text-xs text-[#888] hover:text-white transition-colors tracking-widest">CANCEL</button>
					<button onclick={confirmRename} class="px-6 py-2 bg-[#DBBA87] text-black font-bold text-xs rounded-xl hover:bg-[#c9aa7a] transition-colors shadow-lg flex items-center gap-2 tracking-widest">
						<Check size={14} /> CONFIRM
					</button>
				</div>
			</div>
		</div>
	{/if}

	<aside class="bg-[#1a1a1a]/95 backdrop-blur-xl border-r border-[#333] transition-all duration-300 ease-in-out shadow-2xl z-50 overflow-hidden
		fixed inset-y-0 left-0 h-full md:relative md:h-auto
		{isSidebarOpen ? 'translate-x-0 w-64' : '-translate-x-full w-64 md:w-0 md:translate-x-0'}"
		style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iODAiIHZpZXdCb3g9IjAgMCA4MCA4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJNMCAwIEw4MCA4MCBNODAgMCBMMCA4MCIgc3Ryb2tlPSIjRTVFNEUyIiBzdHJva2Utd2lkdGg9IjAuNSIgc3Ryb2tlLWRhc2hhcnJheT0iMiA4IiBzdHJva2Utb3BhY2l0eT0iMC4xIi8+PHBhdGggZD0iTTQwIDM4IEw0MiA0MCBMNDAgNDIgTDM4IDQwIFoiIGZpbGw9IiNiODg2MGIiIGZpbGwtb3BhY2l0eT0iMC4xIi8+PC9zdmc+'); background-size: 80px 80px;">
		
		<div class="h-full w-64 flex flex-col overflow-y-auto relative z-10">
			<div class="p-6 border-b border-[#333] flex justify-between items-start">
				<div class="flex flex-col">
					<span class="font-serif text-2xl font-bold text-[#f5f5f5] tracking-wider italic">JustLobe</span>
					<span class="text-[10px] text-[#DBBA87] uppercase tracking-[0.2em] mt-1">Premium Edition</span>
				</div>
				<button class="md:hidden text-[#666] hover:text-white transition-colors p-1" onclick={() => isSidebarOpen = false} aria-label="Close Sidebar"><X size={24} /></button>
			</div>
			
			<div class="p-3 space-y-4">
				<div class="bg-gradient-to-br from-[#222] to-[#111] border border-[#333] p-3 rounded-xl relative overflow-hidden group shadow-lg mx-1">
					<div class="absolute top-0 right-0 p-2 opacity-20 group-hover:opacity-50 transition-opacity"><Crown size={32} /></div>
					<div class="text-[10px] text-[#888] mb-1 font-bold tracking-wider">CURRENT PLAN</div>
					<div class="text-[#DBBA87] font-bold flex items-center gap-2 text-sm"><Diamond size={14} fill="currentColor"/> Ultimate Pro</div>
					<div class="mt-3 text-[10px] text-[#666] border-t border-[#333] pt-2 flex justify-between items-center whitespace-nowrap">
						<span>EXP: 1 WEEK</span>
						<span class="text-red-400/80 animate-pulse bg-red-900/10 px-1 rounded">URGENT</span>
					</div>
				</div>

				<button onclick={startNewSession} class="w-full border border-[#333] hover:border-[#DBBA87] text-[#888] hover:text-[#DBBA87] py-3 rounded-xl flex items-center justify-center gap-2 transition-all duration-300 text-sm uppercase tracking-widest bg-[#222]/50 hover:bg-[#2a2a2a]">
					<Plus size={16}/> New Thread
				</button>
			</div>
			
			<nav class="flex-1 p-2 space-y-2">
				<div class="text-[10px] text-[#666] px-4 py-2 uppercase tracking-widest">History Logs</div>
				
				<!-- 1. 当前会话 (Active) -->
				<div class="group mx-2 p-3 rounded-xl bg-[#2a2a2a] border border-[#DBBA87]/40 text-[#fff] text-xs flex items-center gap-3 cursor-default relative shadow-lg">
					<MessageSquare size={14} class="text-[#DBBA87]"/> 
					<span class="truncate flex-1 font-serif pr-6 font-bold">{currentTitle}</span>
					<div class="w-1.5 h-1.5 rounded-full bg-green-500 shadow-[0_0_5px_rgba(34,197,94,0.5)]"></div>
					</div>
						[{
							"resource": "/d:/JustLobe/frontend/src/routes/+page.svelte",
							"owner": "_generated_diagnostic_collection_name_#3",
							"code": "node_invalid_placement",
							"severity": 8,
							"message": "`<button>` cannot be a child of `<button>`. The browser will 'repair' the HTML (by moving, removing, or inserting elements) which breaks Svelte's assumptions about the structure of your components.\nhttps://svelte.dev/e/node_invalid_placement",
							"source": "svelte",
							"startLineNumber": 315,
							"startColumn": 7,
							"endLineNumber": 322,
							"endColumn": 16,
							"origin": "extHost1"
						}]
				</nav>

			<div class="p-4 text-[10px] text-[#555] border-t border-[#333] text-center font-serif italic whitespace-nowrap truncate opacity-70 hover:opacity-100 transition-opacity">
				"Powered by Code & Caffeine."
			</div>
		</div>
	</aside>

	{#if isSidebarOpen}
		<button class="fixed inset-0 bg-black/80 z-40 md:hidden backdrop-blur-sm w-full h-full border-none cursor-default" onclick={() => isSidebarOpen = false} aria-label="Close Sidebar"></button>
	{/if}

	<main class="flex flex-1 flex-col relative w-full bg-[#141414] overflow-hidden">
		<div class="absolute inset-0 z-0 pointer-events-none" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDAiIGhlaWdodD0iNDAiIHZpZXdCb3g9IjAgMCA0MCA0MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48IS0tIEdvbGQgTGluZXMgLS0+PHBhdGggZD0iTTAgMCBMNDAgNDAgTTQwIDAgTDAgNDAiIHN0cm9rZT0iI2I4ODYwYiIgc3Ryb2tlLXdpZHRoPSIwLjgiIHN0cm9rZS1kYXNoYXJyYXk9IjQgMTYiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLW9wYWNpdHk9IjAuMjUiLz48IS0tIFNpbHZlciBMaW5lcyAoT2Zmc2V0KSAtLT48cGF0aCBkPSJNMCAwIEw0MCA0MCBNNDAgMCBMMCA0MCIgc3Ryb2tlPSIjRTVFNEUyIiBzdHJva2Utd2lkdGg9IjAuOCIgc3Ryb2tlLWRhc2hhcnJheT0iNCAxNiIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjEwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1vcGFjaXR5PSIwLjE1Ii8+PCEtLSBEb3RzIC0tPjxjaXJjbGUgY3g9IjIwIiBjeT0iMjAiIHI9IjEiIGZpbGw9IiNiODg2MGIiIGZpbGwtb3BhY2l0eT0iMC4zIi8+PGNpcmNsZSBjeD0iMCIgY3k9IjIwIiByPSIwLjgiIGZpbGw9IiNFNUU0RTIiIGZpbGwtb3BhY2l0eT0iMC4yIi8+PGNpcmNsZSBjeD0iMjAiIGN5PSIwIiByPSIwLjgiIGZpbGw9IiNFNUU0RTIiIGZpbGwtb3BhY2l0eT0iMC4yIi8+PC9zdmc+'); background-size: 40px 40px; opacity: 0.4;"></div>
		
		<header class="h-16 flex items-center justify-between px-6 border-b border-[#222] bg-[#141414]/80 backdrop-blur-md sticky top-0 z-30">
			<div class="flex items-center gap-4">
				<button class="p-2 border border-[#333] rounded-xl bg-[#1a1a1a] text-[#888] hover:bg-[#DBBA87] hover:text-black hover:border-[#DBBA87] transition-all shadow-sm" onclick={() => isSidebarOpen = !isSidebarOpen} aria-label="Toggle Sidebar"><Menu size={20} /></button>
				<button class="flex flex-col group cursor-pointer text-left bg-transparent border-none p-0" onclick={() => openRename(-1)} aria-label="Rename conversation">
					<div class="flex items-center gap-2">
						<span class="font-serif font-bold text-[#e5e5e5] text-lg leading-none group-hover:text-[#DBBA87] transition-colors">{currentTitle}</span>
						<Edit2 size={12} class="opacity-0 group-hover:opacity-50 text-[#888] transition-opacity"/>
					</div>
					<div class="flex items-center gap-1.5 mt-0.5">
						<div class="w-1.5 h-1.5 rounded-full bg-green-500 shadow-[0_0_5px_rgba(34,197,94,0.5)]"></div>
						<span class="font-serif italic text-[10px] font-bold tracking-widest text-[#666]">DEEPSEEK V3</span>
					</div>
				</button>
			</div>
			<button onclick={clearChat} class="text-[#666] hover:text-red-400 transition-colors"><Trash2 size={18}/></button>
		</header>

		<section bind:this={scrollContainer} class="flex-1 overflow-y-auto p-4 md:p-8 space-y-8 scroll-smooth">
			<div class="max-w-4xl mx-auto space-y-8">
<!-- 2. 历史会话列表 (History) -->
				{#each archivedSessions as session, i}
					<!-- 外层容器：div (充当按钮) -->
					<div 
						onclick={() => switchSession(i)}
						onkeydown={(e) => e.key === 'Enter' && switchSession(i)}
						role="button"
						tabindex="0"
						class="w-full group mx-2 p-3 rounded-xl bg-transparent border border-transparent text-[#999] text-xs flex items-center gap-3 hover:bg-[#222] hover:border-[#333] cursor-pointer transition-all relative text-left"
					>
						<History size={14} class="text-[#666] group-hover:text-[#DBBA87] transition-colors"/> 
						<span class="truncate flex-1 font-serif pr-6 group-hover:text-[#ccc] transition-colors">{session.title}</span>
						
						<!-- 内部小按钮：调用 handleRenameClick -->
						<button 
							type="button"
							onclick={(e) => handleRenameClick(e, i)}
							class="absolute right-2 opacity-0 group-hover:opacity-100 transition-opacity text-[#666] hover:text-[#DBBA87] p-1 bg-transparent border-none cursor-pointer"
							aria-label="Rename"
						>
							<Edit2 size={12} />
						</button>
					</div>
				{/each}
			</div>
		</section>

		<footer class="p-6">
			<div class="max-w-4xl mx-auto">
				<div class="relative group bg-[#262626] border border-[#444] rounded-3xl focus-within:border-[#DBBA87] focus-within:shadow-[0_0_20px_rgba(219,186,135,0.2)] transition-all duration-300 overflow-hidden">
					<div class="flex items-end p-2">
						<textarea bind:value={inputText} onkeydown={handleKeyDown} placeholder="Input command sequence..." class="flex-1 max-h-40 min-h-[50px] p-4 bg-transparent border-none outline-none text-base resize-none placeholder-[#a3a3a3] text-white" disabled={isLoading}></textarea>
						<div class="p-2">
							{#if isLoading}
								<button onclick={stopGeneration} class="p-3 bg-red-900/40 text-red-200 hover:bg-red-600 hover:text-white border border-red-500/50 rounded-full transition-all"><Square size={20} fill="currentColor" /></button>
							{:else}
								<button onclick={sendMessage} class="p-3 bg-[#444] text-white hover:bg-[#DBBA87] hover:text-black rounded-full transition-all disabled:opacity-30 disabled:cursor-not-allowed shadow-lg" disabled={!inputText.trim()}><Send size={20}/></button>
							{/if}
						</div>
					</div>
				</div>
				<div class="text-center mt-3 text-[10px] text-[#666] font-serif tracking-widest">JUSTLOBE SYSTEM © 2026. ALL RIGHTS RESERVED.</div>
			</div>
		</footer>
	</main>
</div>

<style>
	:global(::-webkit-scrollbar) { width: 6px; }
	:global(::-webkit-scrollbar-track) { background: #141414; }
	:global(::-webkit-scrollbar-thumb) { background: #333; border-radius: 3px; }
	:global(::-webkit-scrollbar-thumb:hover) { background: #DBBA87; }
	.markdown-body :global(pre) { background: #000 !important; border: none !important; color: #DBBA87 !important; padding: 1rem; margin: 0.8rem 0; overflow-x: auto; font-family: 'Lora', serif !important; font-size: 0.95em; border-radius: 12px; }
	.markdown-body :global(code) { font-family: 'Lora', serif !important; background: transparent !important; border: none !important; padding: 0; color: inherit; }
	.markdown-body :global(p code), .markdown-body :global(li code) { background: rgba(255,255,255,0.1) !important; padding: 0.1rem 0.4rem !important; border-radius: 4px; color: #fff !important; }
	.markdown-body :global(p) { margin-bottom: 0; line-height: 1.7; font-family: 'Lora', serif; }
	.markdown-body :global(h1), .markdown-body :global(h2), .markdown-body :global(h3) { font-family: 'Playfair Display', serif; font-weight: 600; color: #fff; margin: 1.5rem 0 0.5rem 0; }
	.markdown-body :global(blockquote) { border-left: 3px solid #DBBA87; padding-left: 1rem; margin: 0.5rem 0; color: #999; font-style: italic; }
	.markdown-body :global(strong) { color: #fff; font-weight: 600; }
	.markdown-body :global(ul), .markdown-body :global(ol) { padding-left: 1.2rem; margin: 0.5rem 0; }
</style>
</file>

</files>
